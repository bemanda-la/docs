# Consulta de Detalles de Mora de un Usuario (nivel usuario)

Este endpoint permite obtener los detalles de los atrasos de un usuario en relación con los préstamos y las cuotas asociadas a su cuenta.

### Endpoint

`GET /v1/me/arrears_detail`

### Requisitos de Acceso

- **Scope necesario**: `user`
- **Autenticación**: Se requiere un token Bearer válido. Incluye el encabezado `Authorization` en tu solicitud:

```http
Authorization: Bearer <tu_token>
```

Asegúrate de reemplazar `<tu_token>` con un token válido. Para obtener un token, consulta la guía de [autenticación](/docs/authentication/).

## Parámetros

### Query Parameters

- **loan_id** (opcional): Identificador del préstamo asociado al atraso.
- **date** (opcional): Fecha específica para consultar los detalles de los atrasos en esa fecha.
- **start_date** (opcional): Fecha de inicio para el rango de consulta de atrasos.
- **end_date** (opcional): Fecha de fin para el rango de consulta de atrasos.
- **page**: Número de página (por defecto `1`).
- **items_per_page**: Número de elementos por página (por defecto `10`)..

## Ejemplos de Llamadas

### Usando cURL

```bash
curl -X GET \
  {base_url}/v1/me/arrears_detail?{loan_id}&page=1&items_per_page=10 \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

### Usando Node.js

```javascript
import fetch from "node-fetch";

async function getArrearsDetail(
  token,
  loanId,
  startDate,
  endDate,
  page = 1,
  itemsPerPage = 10
) {
  const response = await fetch(
    `${base_url}/v1/me/arrears_detail?loan_id=${loanId}&start_date=${startDate}&end_date=${endDate}&page=${page}&items_per_page=${itemsPerPage}`,
    {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      },
    }
  );

  if (!response.ok) {
    throw new Error(`Error fetching arrears details: ${response.statusText}`);
  }

  const data = await response.json();
  console.log(data);
}

// Ejemplo de uso
const token = "YOUR_ACCESS_TOKEN";
getArrearsDetail(token, "12345", "2025-01-01", "2025-01-31").catch(
  console.error
);
```

## Respuesta

La respuesta incluye los detalles de los atrasos asociados al usuario y la información de paginación.

### Estructura de Respuesta

```json
{
  "success": true,
  "data": [
    {
      "id": "abc123",
      "user_id": "user123",
      "loan_id": "loan123",
      "installment_id": "installment123",
      "installment_expiration": "2025-01-15T00:00:00Z",
      "days_of_arrear": 5,
      "days_of_grace": 10,
      "created_at": "2025-01-15T10:00:00Z"
    }
  ],
  "error": null,
  "pagination": {
    "page": 1,
    "items_per_page": 10,
    "total_items": 20,
    "total_pages": 2
  }
}
```

### Detalles de los Campos

### Campos Principales

- **success:** Indica si la solicitud fue exitosa.
- **data:** Lista de préstamos del usuario autenticado.
- **error:** Detalles del error (si existe).
- **pagination:** Información de paginación.

### Campos de un Usuario Moroso

- **id:** Identificador único del detalle de atraso.
- **user_id:** Identificador del usuario asociado al atraso.
- **loan_id:** Identificador del préstamo asociado al atraso.
- **installment_id:** Identificador de la cuota asociada al atraso.
- **installment_expiration:** Fecha de vencimiento de la cuota.
- **days_of_arrear:** Número de días de atraso en el pago de la cuota.
- **days_of_grace:** Número de días de gracia otorgados para el pago.
- **created_at:** Fecha de creación del registro de atraso.
