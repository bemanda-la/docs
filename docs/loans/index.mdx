# Consulta de Préstamo por ID (nivel usuario)

Esta guía detalla cómo consultar la información de un préstamo en el sistema utilizando su ID, basada en el modelo definido.

## Endpoint

`GET /v1/me/loans/loan_id/:loan_id`

## Parámetros

- `loan_id` (path): Identificador único del préstamo en formato UUID.

## Autenticación

Este endpoint requiere autenticación mediante un token Bearer. Incluye el encabezado `Authorization` en tu solicitud:

```
Authorization: Bearer <tu_token>
```

Asegúrate de reemplazar `<tu_token>` con un token válido. Para obtener un token, consulta la guía de [autenticación](/docs/authentication/).

## Ejemplos de Llamadas

### Usando cURL

```bash
curl -X GET \
  {base_url}/v1/me/loans/loan_id/{loan_id} \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

### Usando Node.js

```javascript
const fetch = require("node-fetch");

async function getLoan(loanId, token) {
  const response = await fetch(`${base_url}/v1/me/loans/loan_id/${loanId}`, {
    method: "GET",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
  });

  if (!response.ok) {
    throw new Error(`Error fetching loan: ${response.statusText}`);
  }

  const loanData = await response.json();
  console.log(loanData);
}

// Usage example
const loanId = "018c0f5b-4d4b-7bde-89a6-6f2a4d60f56e";
const token = "YOUR_ACCESS_TOKEN";
getLoan(loanId, token).catch(console.error);
```

## Respuesta

La respuesta incluye la estructura estándar para los recursos, con los siguientes elementos:

### Estructura de Respuesta

```json
{
  "success": true,
  "data": {
    "id": "1c5a332f-7495-4d4a-a739-fe348c1691bc",
    "user_id": "01917175-3a97-7c33-868a-7c5723e34687",
    "application_id": "01917166-b939-7ffc-8b21-13294c183d8e",
    "product_id": "20a9ad2e-8867-4242-b9f4-310865db5f82",
    "currency_id": "ARS",
    "requested_amount": "1000",
    "interest_rate": "5",
    "penalty_rate": "1",
    "bonus_amount": "50",
    "bonus_percentage": "5",
    "total_amount": "1050",
    "paid_amount": "525",
    "balance": "525",
    "installment_quantity": 12,
    "requested_date": "2024-07-12T15:12:24.614Z",
    "approved_date": null,
    "credited_date": null,
    "last_payment_date": null,
    "fully_paid_date": null,
    "status_id": "in_progress",
    "other_info": null,
    "installments": [
      {
        "id": "14cc84a0-4cdb-4f99-974b-2a86f3211bd9",
        "loan_id": "1c5a332f-7495-4d4a-a739-fe348c1691bc",
        "due_date": "2024-11-11T15:12:24.711Z",
        "currency_id": "ARS",
        "due_amount": "8000",
        "paid_amount": "0",
        "balance": "8000",
        "number": 1,
        "status_id": "in_arrear",
        "created_at": "2024-11-19T17:35:02.671Z",
        "updated_at": "2024-11-19T17:35:31.610Z"
      }
    ],
    "bonus_conditions": [
      {
        "id": "b8b08b4b-90b5-496c-ae56-3242c59b83db",
        "application_id": "app1",
        "name": "Early Payment",
        "description": "Bonus for early payment",
        "other_info": {}
      }
    ],
    "audit_logs": [
      {
        "id": "98f791ea-51a1-480f-9d4a-cd6cfa696d88",
        "loan_id": "1c5a332f-7495-4d4a-a739-fe348c1691bc",
        "user_id": null,
        "action_id": "action1",
        "action_date": "2024-07-12T15:12:24.803Z",
        "data": {}
      }
    ],
    "product": {
      "id": "20a9ad2e-8867-4242-b9f4-310865db5f82",
      "application_id": "01917166-b939-7ffc-8b21-13294c183d8e",
      "name": "Adelanto inmediato",
      "primary_color": "#FFB95F",
      "secondary_color": "#000000",
      "description": "Adelanto inmediato",
      "image_url": null,
      "slogan": "Get your loan now!",
      "currency_id": "USD",
      "category_id": "category2",
      "status_id": "status1",
      "other_info": {}
    },
    "status": {
      "id": "in_progress",
      "name": "En curso",
      "description": "Loan in progress"
    }
  },
  "error": null,
  "pagination": null
}
```

### Detalles de los Campos

- **success:** Indica si la solicitud fue exitosa (`true` o `false`).
- **data:** Objeto con la información del préstamo (detallada abajo).
- **error:** Contendrá detalles de errores en caso de que existan, incluyendo:
  - **code:** Código del error.
  - **message:** Mensaje general del error.
  - **errors:** Lista de errores específicos, cada uno con:
    - **message:** Descripción del error.
    - **location:** Ubicación del error.
- **pagination:** Información de paginación, será `null` porque este recurso no es una lista.

### Campos del Préstamo

- **id:** Identificador único del préstamo.
- **user_id:** Identificador único del usuario asociado al préstamo.
- **application_id:** Identificador de la aplicación asociada.
- **product_id:** Identificador del producto financiero asociado.
- **currency_id:** Identificador de la moneda del préstamo.
- **requested_amount:** Monto solicitado por el usuario.
- **interest_rate:** Tasa de interés aplicada al préstamo.
- **penalty_rate:** Tasa de penalización por incumplimiento.
- **bonus_amount:** Monto del bono asociado al préstamo.
- **bonus_percentage:** Porcentaje del bono sobre el préstamo.
- **total_amount:** Monto total del préstamo, incluyendo intereses y bonos.
- **paid_amount:** Monto pagado hasta el momento.
- **balance:** Saldo pendiente del préstamo.
- **installment_quantity:** Cantidad total de cuotas del préstamo.
- **requested_date:** Fecha en la que se solicitó el préstamo.
- **approved_date:** Fecha en la que se aprobó el préstamo.
- **credited_date:** Fecha en la que se acreditaron los fondos.
- **last_payment_date:** Fecha del último pago realizado.
- **fully_paid_date:** Fecha en la que se completó el pago del préstamo (si aplica).
- **status:** Información del estado actual del préstamo:
  - **id:** Identificador único del estado (e.g., `in_course`).
  - **name:** Nombre descriptivo del estado.
  - **description:** Descripción del estado.
- **installments:** Lista de cuotas asociadas al crédito.
- **bonus_conditions:** Condiciones aplicables al bono otorgado.
- **audit_logs:** Registros de auditoría relacionados con el crédito.
- **product:** Detalles del producto asociado al crédito.

### Relaciones

#### Cuotas

- **id:** Identificador único de la cuota.
- **due_date:** Fecha de vencimiento de la cuota.
- **due_amount:** Monto debido para la cuota.
- **paid_amount:** Monto pagado para la cuota.
- **balance:** Saldo pendiente de la cuota.
- **number:** Número de la cuota.
- **status:** Información del estado actual de la cuota:
  - **id:** Identificador único del estado (e.g., `pending`).
  - **name:** Nombre descriptivo del estado.
  - **description:** Descripción del estado.

#### Bonus Conditions

- **id:** Identificador único de la condición.
- **application_id:** Identificador único de la aplicación asociada.
- **name:** Nombre descriptivo de la condición de bonificación.
- **description:** Descripción detallada de la condición.
- **other_info:** Información adicional relacionada con la condición.

#### Audit Logs

- **id:** Identificador único del registro de auditoría.
- **loan_id:** Identificador único del préstamo asociado al registro.
- **user_id:** Identificador único del usuario que realizó la acción (puede ser `null`).
- **action_id:** Identificador único de la acción realizada.
- **action_date:** Fecha en la que se realizó la acción.
- **data:** Información adicional sobre la acción.

#### Product

- **id:** Identificador único del producto.
- **application_id:** Identificador único de la aplicación asociada al producto.
- **name:** Nombre descriptivo del producto.
- **primary_color:** Color principal del producto en formato hexadecimal.
- **secondary_color:** Color secundario del producto en formato hexadecimal.
- **description:** Descripción del producto.
- **image_url:** URL de la imagen asociada al producto (puede ser `null`).
- **slogan:** Eslogan promocional del producto.
- **currency_id:** Moneda utilizada por el producto (e.j., `USD`).
- **category_id:** Identificador único de la categoría del producto.
- **status_id:** Identificador único del estado del producto.
- **other_info:** Información adicional relacionada con el producto.

## Notas

- Asegúrate de que el `loan_id` corresponde a un préstamo existente antes de realizar la consulta.
- Para validar la autenticidad de las solicitudes, utiliza las firmas digitales incluidas en los encabezados del webhook.
- La respuesta puede incluir información adicional relevante según el contexto del préstamo.
